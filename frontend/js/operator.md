# 运算符

- [位运算](#位运算)
  - [原码、反码、补码](#原码反码补码)
  - [位运算实现加法](#位运算实现加法)
  - [无符号右移 \>\>\>](#无符号右移-)
- [运算优先级](#运算优先级)

## 位运算

`&`: 与，两者都为 1，才为 1  
`|`: 或，两者都为 0， 才为 0  
`^`: 异或，两者相同为 0，相异为 1  
`~`: 按位非，0 变 1，1 变 0，运算时 `~x = -(x+1)`  
`<<`: 左移，左移 n 位，左边超出丢弃，右边补 0  
`>>`: 右移，右移 n 位；无符号，左边补 0，有符号，编译器处理方式不一样。

位运算为机器码运算

负数的位运算：

负数的位运算建立在它的补码上，正数的补码是它本身，负数的补码是，符号位（左边最高位，1为负数，0为正数）不变，其余按位取反。最后再 +1.

### 原码、反码、补码

原码：符号位 + 数字
反码：正数的反码是它本身，负数是原码符号位不变，其余位取反
补码：正数的补码是它本身，负数是其反码 + 1

| | | | |
|-|-|-| - |
| 十进制 |原码|反码|补码|
| 1  | 000000001 | 000000001 | 000000001 |
| -1 | 100000001 | 111111110 | 111111111 |
| 2  | 000000010 | 000000010 | 000000010 |

取值范围：

| | | |
| - | - | - |
|   -   | 范围 | n = 8 |
| 原码 | -(2^(n-1) - 1) ~ 2^(n-1) - 1 | -127 ~ 127 |
| 反码 | -(2^(n-1) - 1) ~ 2^(n-1) - 1 | -127 ~ 127 |
| 补码 | -2^(n-1) ~ 2^(n-1) - 1 | -128 ~ 127 |

2^7 = 128

### 位运算实现加法

公式：`a + b = a^b + (a & b) << 1`

思路：

1. 当前位的相加，0 + 0 = 0, 1+0=1, 1+1=0（二进制进位，当前位为0）。就是当前位 `^` 异或预算
2. 进位操作就是左移一位，就是 `<<` 左移运算。
3. 如何在同为 1 的时候得到进位 1 呢，需要 `a & b` 与运算

```js
function add(a, b) {
  let carry = 0;
  while (b !== 0) {
    // 与运算，得到当前位需要进位 1；后左移 1 位，进位
    carry = (a & b) << 1;
    // 异或运算，得到每个位当前位的结果
    a = a ^ b;
    // carry 有进位，赋值给 b 继续循环
    b = carry;
  }
  return a;
}

console.log(add(5, 3));
```

### 无符号右移 >>>

将左操作数计算为无符号数，并将该数字的二进制表示形式移位为右操作数指定的位数，取模 32。向右移动的多余位将被丢弃，零位从左移入。其符号位变为 0，因此结果始终为非负数。

与其他按位运算符不同，零填充右移返回一个无符号 32 位整数。

```js
const a = 5; //  00000000000000000000000000000101
const b = 2; //  00000000000000000000000000000010
const c = -5; //  11111111111111111111111111111011

console.log(a >>> b); //  00000000000000000000000000000001
// Expected output: 1

console.log(c >>> b); //  00111111111111111111111111111110
// Expected output: 1073741822
```

## 运算优先级

下面代码的输出是什么?

```js
let number = 0;
console.log(number++);
console.log(++number);
console.log(number);

A: 1 1 2
B: 1 2 2
C: 0 2 2
D: 0 1 2

// 答案：`C`
// 后缀一元运算符 i++：
// 返回值（返回0）
// 增加值（数字现在是1）

// 前缀一元运算符 ++i：
// 增加值（数字现在是2）
// 返回值（返回2）
```

数据运算中:

`+` 与字符串运算，会变成字符串连接符; 其他运算符会将字符串数字转成数字

```js
"10" + 1
1 + "01"
// "101"

'10' - "1"
10 - "1"
'10' - 1
// 9
```
