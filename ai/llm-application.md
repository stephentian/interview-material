# LLM åº”ç”¨å¼€å‘

## ä¸€ã€å¤§è¯­è¨€æ¨¡å‹åŸºç¡€

### 1.1 ä»€ä¹ˆæ˜¯LLMï¼Ÿ

å¤§è¯­è¨€æ¨¡å‹ï¼ˆLarge Language Modelï¼ŒLLMï¼‰æ˜¯åŸºäºTransformeræ¶æ„çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œé€šè¿‡æµ·é‡æ–‡æœ¬æ•°æ®è®­ç»ƒï¼Œå…·å¤‡ç†è§£å’Œç”Ÿæˆäººç±»è¯­è¨€çš„èƒ½åŠ›ã€‚

> **ğŸ’¡ Transformeræ¶æ„**ï¼šä¸€ç§ç¥ç»ç½‘ç»œç»“æ„ï¼Œæ˜¯ç°ä»£å¤§è¯­è¨€æ¨¡å‹çš„æ ¸å¿ƒåŸºç¡€ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šæƒ³è±¡ä¸€ä¸ªè¶…çº§é˜…è¯»ç†è§£æœºå™¨ï¼Œå®ƒèƒ½åŒæ—¶çœ‹åˆ°æ•´ç¯‡æ–‡ç« ï¼Œå¹¶ä¸”çŸ¥é“æ¯ä¸ªè¯å’Œå…¶ä»–è¯çš„å…³ç³»ã€‚æ¯”å¦‚çœ‹åˆ°"è‹¹æœ"è¿™ä¸ªè¯ï¼Œå®ƒèƒ½æ ¹æ®ä¸Šä¸‹æ–‡åˆ¤æ–­ä½ è¯´çš„æ˜¯æ°´æœè¿˜æ˜¯æ‰‹æœºå“ç‰Œã€‚
> - **ä¾‹å­**ï¼šGPTã€BERTã€Claude éƒ½æ˜¯åŸºäº Transformer æ¶æ„çš„æ¨¡å‹ï¼Œå°±åƒä¸åŒå“ç‰Œçš„æ±½è½¦éƒ½ç”¨å†…ç‡ƒæœºåŸç†ä¸€æ ·ã€‚

**æ ¸å¿ƒç‰¹ç‚¹ï¼š**

- è‡ªå›å½’ç”Ÿæˆï¼šé€tokené¢„æµ‹ä¸‹ä¸€ä¸ªtokenï¼Œæ ¹æ®å‰é¢çš„å†…å®¹é¢„æµ‹ä¸‹ä¸€ä¸ªå­—
  > **ğŸ’¡ Token**ï¼šæ–‡æœ¬çš„æœ€å°å¤„ç†å•ä½ï¼Œå¯ä»¥ç†è§£ä¸º"è¯ç‰‡æ®µ"ã€‚æŠŠå¥å­åˆ‡åˆ†æˆå°å—ï¼Œæ¯ä¸ªå°å—å°±æ˜¯ä¸€ä¸ª Tokenã€‚è‹±æ–‡ä¸­ä¸€ä¸ªå•è¯å¯èƒ½æ˜¯1-2ä¸ªTokenï¼Œä¸­æ–‡ä¸€ä¸ªæ±‰å­—é€šå¸¸æ˜¯1-2ä¸ªTokenã€‚
  > - **ä¾‹å­**ï¼š"æˆ‘çˆ±ç¼–ç¨‹"å¯èƒ½è¢«åˆ†æˆ ["æˆ‘", "çˆ±", "ç¼–", "ç¨‹"] å››ä¸ªTokenï¼›"Hello world" å¯èƒ½æ˜¯ ["Hello", " world"] ä¸¤ä¸ªTokenã€‚

- ä¸Šä¸‹æ–‡ç†è§£ï¼šé€šè¿‡æ³¨æ„åŠ›æœºåˆ¶ç†è§£é•¿æ–‡æœ¬ä¾èµ–
  > **ğŸ’¡ æ³¨æ„åŠ›æœºåˆ¶**ï¼ˆAttention Mechanismï¼‰ï¼šè®©æ¨¡å‹çŸ¥é“å“ªäº›è¯æ›´é‡è¦ã€å“ªäº›è¯ä¹‹é—´æœ‰å…³è”ã€‚
  > - **é€šä¿—è§£é‡Š**ï¼šå°±åƒä½ è¯»æ–‡ç« æ—¶ä¼šé‡ç‚¹å…³æ³¨æŸäº›å…³é”®è¯ï¼Œæ¨¡å‹ä¹Ÿä¼šç»™ä¸åŒçš„è¯åˆ†é…ä¸åŒçš„"æ³¨æ„åŠ›"æƒé‡ã€‚
  > - **ä¾‹å­**ï¼šå¥å­"å°æ˜æŠŠè‹¹æœç»™äº†å°çº¢ï¼Œå¥¹å¾ˆå¼€å¿ƒ"ï¼Œæ¨¡å‹é€šè¿‡æ³¨æ„åŠ›æœºåˆ¶çŸ¥é“"å¥¹"æŒ‡çš„æ˜¯"å°çº¢"è€Œä¸æ˜¯"å°æ˜"ã€‚

- æ¶Œç°èƒ½åŠ›ï¼šè§„æ¨¡å¢å¤§åå‡ºç°çš„æ¨ç†ã€ç¼–ç¨‹ç­‰èƒ½åŠ›
  > **ğŸ’¡ æ¶Œç°èƒ½åŠ›**ï¼ˆEmergent Abilityï¼‰ï¼šæ¨¡å‹å¤§åˆ°ä¸€å®šç¨‹åº¦åçªç„¶å‡ºç°çš„æ–°èƒ½åŠ›ã€‚
  > - **é€šä¿—è§£é‡Š**ï¼šå°±åƒå°æœ‹å‹é•¿å¤§åˆ°æŸä¸ªé˜¶æ®µçªç„¶ä¼šè¯´è¯äº†ï¼Œæ¨¡å‹å‚æ•°è¶…è¿‡ä¸€å®šè§„æ¨¡åï¼Œä¼šçªç„¶å­¦ä¼šåšæ•°å­¦é¢˜ã€å†™ä»£ç ç­‰ä¹‹å‰ä¸ä¼šçš„äº‹æƒ…ã€‚
  > - **ä¾‹å­**ï¼šå°æ¨¡å‹å¯èƒ½åªä¼šç®€å•çš„é—®ç­”ï¼Œä½†GPT-4è¿™æ ·çš„å¤§æ¨¡å‹çªç„¶ä¼šåšå¤æ‚çš„é€»è¾‘æ¨ç†ã€å†™å®Œæ•´çš„é¡¹ç›®ä»£ç ã€‚

**ä¸»æµæ¨¡å‹ï¼š**
| æ¨¡å‹ | æä¾›å•† | ç‰¹ç‚¹ |
|------|--------|------|
| GPT-4/GPT-4o | OpenAI | ç»¼åˆèƒ½åŠ›æœ€å¼ºï¼Œå¤šæ¨¡æ€æ”¯æŒ |
| Claude 3.5 | Anthropic | é•¿ä¸Šä¸‹æ–‡ï¼Œå®‰å…¨æ€§å¥½ |
| DeepSeek | æ·±åº¦æ±‚ç´¢ | å›½äº§é¢†å…ˆï¼Œæ€§ä»·æ¯”é«˜ |
| Qwen | é˜¿é‡Œäº‘ | ä¸­æ–‡èƒ½åŠ›å¼ºï¼Œå¼€æºç‰ˆæœ¬ |
| GLM-4 | æ™ºè°±AI | å›½äº§ï¼Œä¼ä¸šçº§åº”ç”¨ |

### 1.2 Transformeræ¶æ„æ ¸å¿ƒ

```
è¾“å…¥ â†’ Embedding â†’ Positional Encoding
         â†“
    Multi-Head Attention
         â†“
    Feed Forward Network
         â†“
    Layer Normalization
         â†“
       è¾“å‡º
```

> **ğŸ’¡ Embedding**ï¼šæŠŠæ–‡å­—è½¬æ¢æˆæ•°å­—å‘é‡ï¼Œè®©è®¡ç®—æœºèƒ½"ç†è§£"æ–‡å­—ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šå°±åƒç»™æ¯ä¸ªè¯å‘ä¸€å¼ "èº«ä»½è¯"ï¼Œè¿™å¼ èº«ä»½è¯æ˜¯ä¸€ä¸²æ•°å­—ï¼Œæ„æ€ç›¸è¿‘çš„è¯ï¼Œå®ƒä»¬çš„èº«ä»½è¯å·ç ä¹Ÿç›¸è¿‘ã€‚
> - **ä¾‹å­**ï¼š"çŒ«"çš„Embeddingå¯èƒ½æ˜¯ [0.2, 0.8, 0.1]ï¼Œ"ç‹—"çš„å¯èƒ½æ˜¯ [0.25, 0.75, 0.15]ï¼Œè€Œ"æ±½è½¦"çš„å¯èƒ½æ˜¯ [0.9, 0.1, 0.8]ã€‚å¯ä»¥çœ‹å‡ºçŒ«å’Œç‹—çš„å‘é‡æ›´æ¥è¿‘ã€‚

> **ğŸ’¡ Positional Encoding**ï¼šç»™æ¯ä¸ªè¯æ ‡æ³¨å®ƒåœ¨å¥å­ä¸­çš„ä½ç½®ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šTransformeråŒæ—¶çœ‹æ‰€æœ‰è¯ï¼Œä¸çŸ¥é“è°åœ¨å‰è°åœ¨åï¼Œæ‰€ä»¥éœ€è¦ç»™æ¯ä¸ªè¯è´´ä¸ª"åº§ä½å·"æ ‡ç­¾ã€‚
> - **ä¾‹å­**ï¼šå¥å­"æˆ‘å–œæ¬¢ä½ "ï¼Œ"æˆ‘"çš„ä½ç½®ç¼–ç æ˜¯1ï¼Œ"å–œæ¬¢"æ˜¯2ï¼Œ"ä½ "æ˜¯3ã€‚è¿™æ ·æ¨¡å‹æ‰çŸ¥é“é¡ºåºï¼Œä¸ä¼šæŠŠ"ä½ å–œæ¬¢æˆ‘"å’Œ"æˆ‘å–œæ¬¢ä½ "ææ··ã€‚

> **ğŸ’¡ Multi-Head Attention**ï¼šå¤šä¸ª"æ³¨æ„åŠ›å¤´"åŒæ—¶å·¥ä½œï¼Œä»ä¸åŒè§’åº¦ç†è§£å¥å­ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šå°±åƒä¸€ä¸ªç­çº§é‡Œæœ‰å¤šä¸ªå­¦ç”ŸåŒæ—¶è¯»ä¸€ç¯‡æ–‡ç« ï¼Œæ¯ä¸ªå­¦ç”Ÿå…³æ³¨ä¸åŒçš„é‡ç‚¹ï¼Œæœ€åæŠŠå¤§å®¶çš„ç†è§£ç»¼åˆèµ·æ¥ã€‚
> - **ä¾‹å­**ï¼šè¯»"å°æ˜åœ¨åŒ—äº¬ä¹°äº†ä¸€éƒ¨è‹¹æœæ‰‹æœº"ï¼Œä¸€ä¸ªæ³¨æ„åŠ›å¤´å…³æ³¨"è°"ï¼ˆå°æ˜ï¼‰ï¼Œä¸€ä¸ªå…³æ³¨"åœ¨å“ª"ï¼ˆåŒ—äº¬ï¼‰ï¼Œä¸€ä¸ªå…³æ³¨"ä¹°äº†ä»€ä¹ˆ"ï¼ˆè‹¹æœæ‰‹æœºï¼‰ï¼Œç»¼åˆèµ·æ¥ç†è§£æ›´å…¨é¢ã€‚

> **ğŸ’¡ Feed Forward Network**ï¼ˆè¯»éŸ³ï¼šå‰é¦ˆç½‘ç»œï¼‰ï¼šå¯¹æ¯ä¸ªä½ç½®çš„ä¿¡æ¯è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šå°±åƒä¸€ä¸ªåŠ å·¥å‚ï¼ŒæŠŠæ³¨æ„åŠ›æœºåˆ¶æ”¶é›†åˆ°çš„ä¿¡æ¯è¿›è¡Œæ·±åŠ å·¥ï¼Œæå–æ›´é«˜çº§çš„ç‰¹å¾ã€‚
> - **ä¾‹å­**ï¼šæ³¨æ„åŠ›æœºåˆ¶å‘ç°"è‹¹æœ"å’Œ"æ‰‹æœº"æœ‰å…³è”ï¼Œå‰é¦ˆç½‘ç»œè¿›ä¸€æ­¥ç†è§£è¿™æ˜¯"è‹¹æœæ‰‹æœº"è¿™ä¸ªäº§å“æ¦‚å¿µã€‚

> **ğŸ’¡ Layer Normalization**ï¼šè®©æ•°æ®æ›´ç¨³å®šï¼Œè®­ç»ƒæ›´å®¹æ˜“ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šå°±åƒæŠŠä¸åŒé«˜åº¦çš„å°é˜¶éƒ½è°ƒæ•´åˆ°å·®ä¸å¤šé«˜åº¦ï¼Œè¿™æ ·èµ°èµ·æ¥æ›´ç¨³ã€‚è®©ç¥ç»ç½‘ç»œæ¯å±‚çš„è¾“å‡ºæ•°å€¼ä¿æŒåœ¨åˆç†èŒƒå›´ã€‚
> - **ä¾‹å­**ï¼šå¦‚æœæŸå±‚è¾“å‡ºçš„æ•°å€¼å¤ªå¤§æˆ–å¤ªå°ï¼Œæ¨¡å‹è®­ç»ƒä¼šå‡ºé—®é¢˜ã€‚Layer Normalization æŠŠæ•°å€¼"æ ‡å‡†åŒ–"ï¼Œæ¯”å¦‚æŠŠ [100, 0.01, 50] è°ƒæ•´æˆ [1.2, -0.8, 0.6] è¿™æ ·çš„èŒƒå›´ã€‚

**æ ¸å¿ƒç»„ä»¶ï¼š**
1. **Self-Attentionï¼ˆè‡ªæ³¨æ„åŠ›ï¼‰**
   > **ğŸ’¡ Self-Attention**ï¼šæ¯ä¸ªè¯éƒ½ä¼šåˆ¤æ–­å’Œå…¶ä»–è¯æœ‰ä»€ä¹ˆå…³ç³»ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å…³è”åº¦ã€‚æ ¹æ®å…³ç³»å¼ºå¼±æ¥ç†è§£å¥å­ã€‚
   
   - Query, Key, Value ä¸‰å…ƒç»„
     > **ğŸ’¡ Query/Key/Value**ï¼ˆæŸ¥è¯¢/é”®/å€¼ï¼‰ï¼šæ³¨æ„åŠ›æœºåˆ¶çš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚
     > - **é€šä¿—è§£é‡Š**ï¼šæƒ³è±¡ä½ åœ¨å›¾ä¹¦é¦†æ‰¾ä¹¦ï¼šQueryæ˜¯ä½ æƒ³æ‰¾çš„å†…å®¹ï¼ŒKeyæ˜¯æ¯æœ¬ä¹¦çš„æ ‡ç­¾ï¼ŒValueæ˜¯ä¹¦çš„å†…å®¹ã€‚ç”¨Queryå’ŒKeyåŒ¹é…ï¼Œæ‰¾åˆ°ç›¸å…³çš„Valueã€‚
     > - **ä¾‹å­**ï¼šå¥å­"æˆ‘åƒäº†ä¸€ä¸ªè‹¹æœ"ï¼Œå¯¹äº"åƒ"è¿™ä¸ªè¯ï¼šQueryæ˜¯"åƒæƒ³æ‰¾ä»€ä¹ˆ"ï¼ŒKeyæ˜¯å…¶ä»–è¯çš„èº«ä»½æ ‡ç­¾ï¼ŒValueæ˜¯å…¶ä»–è¯çš„å«ä¹‰ã€‚"åƒ"å’Œ"è‹¹æœ"çš„Query-KeyåŒ¹é…åº¦é«˜ï¼Œæ‰€ä»¥é‡ç‚¹å…³æ³¨"è‹¹æœ"è¿™ä¸ªValueã€‚
   
   - è®¡ç®—å…¬å¼ï¼šAttention(Q,K,V) = softmax(QK^T/âˆšd)V
     > **ğŸ’¡ Softmax**ï¼šæŠŠä¸€ç»„æ•°å­—è½¬æ¢æˆæ¦‚ç‡åˆ†å¸ƒï¼ˆæ‰€æœ‰å€¼åŠ èµ·æ¥ç­‰äº1ï¼‰ã€‚
     > - **é€šä¿—è§£é‡Š**ï¼šæŠŠä»»æ„æ•°å­—å˜æˆ"ç™¾åˆ†æ¯”"ï¼Œæ–¹ä¾¿æ¯”è¾ƒå¤§å°ã€‚
     > - **ä¾‹å­**ï¼š[2, 1, 0.1] ç»è¿‡ softmax å˜æˆ [0.659, 0.242, 0.099]ï¼ŒåŠ èµ·æ¥æ­£å¥½æ˜¯1ï¼Œå¯ä»¥çœ‹å‡ºç¬¬ä¸€ä¸ªæ•°æœ€é‡è¦ã€‚
   
   - ç¼©æ”¾å› å­âˆšdé˜²æ­¢æ¢¯åº¦æ¶ˆå¤±
     > **ğŸ’¡ æ¢¯åº¦æ¶ˆå¤±**ï¼šç¥ç»ç½‘ç»œè®­ç»ƒæ—¶ï¼Œè¯¯å·®ä¿¡å·ä¼ åˆ°å‰é¢çš„å±‚æ—¶å˜å¾—å¤ªå°ï¼Œå¯¼è‡´å‰é¢çš„å±‚å­¦ä¸åˆ°ä¸œè¥¿ã€‚å°±åƒä¼ è¯æ¸¸æˆï¼Œæ¶ˆæ¯ä¼ ç€ä¼ ç€å°±æ²¡äº†ã€‚ç¼©æ”¾å› å­å°±æ˜¯è®©æ¶ˆæ¯ä¸è¦è¡°å‡å¤ªå¿«ã€‚

2. **Layer Normalization**
   - å¯¹æ¯ä¸ªæ ·æœ¬çš„æ‰€æœ‰ç‰¹å¾è¿›è¡Œå½’ä¸€åŒ–
   - é€‚åˆNLPä»»åŠ¡ï¼ˆvs Batch Normalizationï¼‰
     > **ğŸ’¡ NLP**ï¼ˆNatural Language Processingï¼Œè‡ªç„¶è¯­è¨€å¤„ç†ï¼‰ï¼šè®©è®¡ç®—æœºç†è§£äººç±»è¯­è¨€çš„æŠ€æœ¯ã€‚
     > - **é€šä¿—è§£é‡Š**ï¼šæ•™è®¡ç®—æœºå¬æ‡‚äººè¯ã€è¯´äººè¯çš„æŠ€æœ¯ã€‚
     > - **ä¾‹å­**ï¼šæœºå™¨ç¿»è¯‘ã€æ™ºèƒ½å®¢æœã€è¯­éŸ³åŠ©æ‰‹éƒ½æ˜¯NLPçš„åº”ç”¨ã€‚

3. **Positional Encoding**
   - ä¸ºåºåˆ—ä½ç½®æ·»åŠ ä½ç½®ä¿¡æ¯
   - æ­£å¼¦/ä½™å¼¦å‡½æ•°ç¼–ç ï¼Œç”¨ä¸‰è§’å‡½æ•°ç»™ä½ç½®ç¼–ç ï¼Œç”¨æ³¢æµªå½¢çš„æ•°å­—ç»™æ¯ä¸ªä½ç½®ä¸€ä¸ªç‹¬ç‰¹çš„"æŒ‡çº¹"ã€‚

## äºŒã€LLM APIè°ƒç”¨

### 2.1 OpenAI API

```javascript
import OpenAI from 'openai';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
  dangerouslyAllowBrowser: true
});

const completion = await openai.chat.completions.create({
  model: 'gpt-4o',
  messages: [
    { role: 'system', content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åŠ©æ‰‹' },
    { role: 'user', content: 'è¯·è§£é‡Šä»€ä¹ˆæ˜¯é—­åŒ…' }
  ],
  temperature: 0.7,
  max_tokens: 1000
});

console.log(completion.choices[0].message.content);
```

### 2.2 æµå¼è°ƒç”¨ï¼ˆSSEï¼‰

> **ğŸ’¡ SSE**ï¼ˆServer-Sent Eventsï¼ŒæœåŠ¡å™¨æ¨é€äº‹ä»¶ï¼‰ï¼šæœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®çš„æŠ€æœ¯ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šå°±åƒçœ‹è§†é¢‘ç›´æ’­ï¼Œä¸ç”¨ç­‰æ•´ä¸ªè§†é¢‘ä¸‹è½½å®Œï¼Œä¸€è¾¹ä¸‹è½½ä¸€è¾¹çœ‹ã€‚AIå¯¹è¯ä¸­ï¼Œä¸ç”¨ç­‰AIå†™å®Œæ‰€æœ‰å†…å®¹ï¼Œå†™ä¸€ç‚¹å°±æ˜¾ç¤ºä¸€ç‚¹ã€‚
> - **ä¾‹å­**ï¼šChatGPTå›ç­”é—®é¢˜æ—¶ï¼Œæ–‡å­—ä¸€ä¸ªä¸€ä¸ªè¹¦å‡ºæ¥ï¼Œå°±æ˜¯ç”¨SSEå®ç°çš„ï¼Œè€Œä¸æ˜¯ç­‰å¾ˆä¹…åä¸€æ¬¡æ€§æ˜¾ç¤ºå…¨éƒ¨å†…å®¹ã€‚

```javascript
const stream = await openai.chat.completions.create({
  model: 'gpt-4o',
  messages: [{ role: 'user', content: 'å†™ä¸€é¦–è¯—' }],
  stream: true
});

for await (const chunk of stream) {
  const content = chunk.choices[0]?.delta?.content || '';
  process.stdout.write(content);
}
```

SSE å’Œ WebSocket éƒ½æ˜¯å®ç°æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®çš„æŠ€æœ¯ï¼Œä½†å®ƒä»¬æœ‰ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œå®ç°æ–¹å¼ã€‚

- **SSE**ï¼š
  - åŸºäºHTTPï¼Œç®€å•æ˜“ç”¨ï¼Œæ”¯æŒæµè§ˆå™¨å’ŒNode.jsã€‚
  - ç®€å•çš„æ–‡æœ¬æ ¼å¼ï¼Œæ¯ä¸ªäº‹ä»¶åŒ…å«ä¸€ä¸ªäº‹ä»¶åå’Œæ•°æ®ã€‚
  - é€‚åˆç®€å•çš„å®æ—¶é€šçŸ¥åœºæ™¯ï¼Œå¦‚èŠå¤©åº”ç”¨ä¸­çš„æ–°æ¶ˆæ¯æç¤ºã€‚

- **WebSocket**ï¼š
  - åŸºäºTCPï¼Œå…¨åŒå·¥é€šä¿¡ï¼Œæ”¯æŒäºŒè¿›åˆ¶æ•°æ®ä¼ è¾“ã€‚
  - æ›´å¤æ‚çš„åè®®ï¼Œéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½å®ç°ã€‚
  - é€‚åˆéœ€è¦å®æ—¶äº¤äº’çš„åœºæ™¯ï¼Œå¦‚åœ¨çº¿æ¸¸æˆã€å®æ—¶æ•°æ®å¯è§†åŒ–ç­‰ã€‚

ä¸ºä»€ä¹ˆè¦é€‰æ‹©SSEè€Œä¸æ˜¯WebSocketï¼Ÿ

- **ç®€å•æ˜“ç”¨**ï¼šSSEåŸºäºHTTPï¼Œä¸éœ€è¦å¤æ‚çš„åè®®å®ç°ï¼Œç›´æ¥åœ¨æµè§ˆå™¨å’ŒNode.jsä¸­ä½¿ç”¨ã€‚
- **å…¼å®¹æ€§å¥½**ï¼šSSEæ”¯æŒæ‰€æœ‰ç°ä»£æµè§ˆå™¨ï¼ŒåŒ…æ‹¬ç§»åŠ¨è®¾å¤‡ã€‚
- **æˆæœ¬ä½**ï¼šSSEæ˜¯ä¸€ç§è½»é‡çº§çš„é€šä¿¡åè®®ï¼Œä¸éœ€è¦æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯éƒ½å®ç°å¤æ‚çš„é€»è¾‘ã€‚

### 2.3 å›½äº§æ¨¡å‹è°ƒç”¨

**DeepSeekç¤ºä¾‹ï¼š**
```javascript
const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${process.env.DEEPSEEK_API_KEY}`
  },
  body: JSON.stringify({
    model: 'deepseek-chat',
    messages: [{ role: 'user', content: 'ä½ å¥½' }],
    stream: false
  })
});
```

## ä¸‰ã€å…³é”®å‚æ•°è§£æ

### 3.1 ç”Ÿæˆå‚æ•°

| å‚æ•° | è¯´æ˜ | æ¨èå€¼ |
|------|------|--------|
| temperature | æ§åˆ¶éšæœºæ€§ï¼Œ0-2 | åˆ›æ„ä»»åŠ¡0.7-1.0ï¼Œç²¾ç¡®ä»»åŠ¡0-0.3 |
| max_tokens | æœ€å¤§ç”Ÿæˆé•¿åº¦ | æ ¹æ®éœ€æ±‚è®¾ç½® |
| top_p | æ ¸é‡‡æ ·å‚æ•° | é€šå¸¸0.9-1.0 |
| frequency_penalty | é¢‘ç‡æƒ©ç½š | 0-2ï¼Œå‡å°‘é‡å¤ |
| presence_penalty | å­˜åœ¨æƒ©ç½š | 0-2ï¼Œé¼“åŠ±å¤šæ ·æ€§ |
| stop | åœæ­¢è¯ | è‡ªå®šä¹‰ç»“æŸæ ‡è®° |

> **ğŸ’¡ Temperature**ï¼ˆæ¸©åº¦å‚æ•°ï¼‰ï¼šæ§åˆ¶æ¨¡å‹è¾“å‡ºçš„éšæœºæ€§/åˆ›é€ æ€§ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šæ¸©åº¦ä½ï¼Œæ¨¡å‹æ›´ä¿å®ˆï¼Œå›ç­”æ›´ç¡®å®šï¼›æ¸©åº¦é«˜ï¼Œæ¨¡å‹æ›´æœ‰åˆ›æ„ï¼Œå›ç­”æ›´å¤šæ ·ã€‚
> - **ä¾‹å­**ï¼šé—®"1+1ç­‰äºå‡ ï¼Ÿ"ï¼Œæ¸©åº¦0ä¼šå›ç­”"2"ï¼›æ¸©åº¦1å¯èƒ½å›ç­”"ä»æ•°å­¦è§’åº¦æ˜¯2ï¼Œä½†åœ¨æŸäº›æƒ…å¢ƒä¸‹..."å¼€å§‹å‘æ•£ã€‚å†™ä»£ç ç”¨ä½æ¸©åº¦ï¼ˆ0-0.3ï¼‰ï¼Œå†™è¯—ç”¨é«˜æ¸©åº¦ï¼ˆ0.7-1.0ï¼‰ã€‚

> **ğŸ’¡ Top_p**ï¼ˆæ ¸é‡‡æ ·ï¼‰ï¼šæ§åˆ¶æ¨¡å‹ä»æ¦‚ç‡æœ€é«˜çš„å¤šå°‘è¯ä¸­é€‰æ‹©ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šæ¨¡å‹é¢„æµ‹ä¸‹ä¸€ä¸ªè¯æ—¶æœ‰å¾ˆå¤šå€™é€‰ï¼Œtop_p=0.9è¡¨ç¤ºåªä»æ¦‚ç‡åŠ èµ·æ¥å 90%çš„é‚£äº›è¯é‡Œé€‰ï¼Œè¿‡æ»¤æ‰ä¸å¤ªå¯èƒ½çš„è¯ã€‚
> - **ä¾‹å­**ï¼šé¢„æµ‹"ä»Šå¤©å¤©æ°”"åé¢ï¼Œå€™é€‰è¯æ¦‚ç‡ï¼šå¾ˆå¥½(40%)ã€ä¸é”™(30%)ã€ä¸€èˆ¬(20%)ã€ç³Ÿç³•(5%)ã€é¦™è•‰(5%)ã€‚top_p=0.9æ—¶ï¼Œ"é¦™è•‰"ä¼šè¢«è¿‡æ»¤æ‰ï¼Œå› ä¸ºå‰å‡ ä¸ªè¯æ¦‚ç‡å’Œå·²ç»è¶…è¿‡90%ã€‚

> **ğŸ’¡ Frequency Penalty**ï¼ˆé¢‘ç‡æƒ©ç½šï¼‰ï¼šæƒ©ç½šå·²ç»å‡ºç°è¿‡çš„è¯ï¼Œå‡å°‘é‡å¤ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šå‘Šè¯‰æ¨¡å‹"è¿™ä¸ªè¯ä½ å·²ç»ç”¨è¿‡äº†ï¼Œå°‘ç”¨ç‚¹"ï¼Œé˜²æ­¢è½¦è½±è¾˜è¯ã€‚
> - **ä¾‹å­**ï¼šæ²¡æœ‰é¢‘ç‡æƒ©ç½šæ—¶ï¼Œæ¨¡å‹å¯èƒ½å†™"è¿™ä¸ªå¾ˆå¥½ï¼Œè¿™ä¸ªå¾ˆå¥½ï¼Œè¿™ä¸ªå¾ˆå¥½..."ï¼›åŠ ä¸Šæƒ©ç½šåï¼Œä¼šå˜æˆ"è¿™ä¸ªå¾ˆå¥½ï¼Œé‚£ä¸ªä¹Ÿä¸é”™ï¼Œå¦ä¸€ä¸ªè¿˜å¯ä»¥..."ã€‚

> **ğŸ’¡ Presence Penalty**ï¼ˆå­˜åœ¨æƒ©ç½šï¼‰ï¼šæƒ©ç½šå‡ºç°è¿‡çš„è¯ï¼Œé¼“åŠ±è¯´æ–°å†…å®¹ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šå‘Šè¯‰æ¨¡å‹"è¯´ç‚¹æ–°é²œçš„"ï¼Œé¼“åŠ±å¼•å…¥æ–°è¯é¢˜ã€‚
> - **ä¾‹å­**ï¼šèŠå¤©æ—¶ï¼Œæ¨¡å‹ä¸€ç›´åœ¨è¯´"å¤©æ°”"ï¼ŒåŠ ä¸Šå­˜åœ¨æƒ©ç½šåï¼Œä¼šä¸»åŠ¨èŠåˆ°"é¥®é£Ÿ"ã€"äº¤é€š"ç­‰æ–°è¯é¢˜ã€‚

### 3.2 Tokenè®¡ç®—

```javascript
function estimateTokens(text) {
  const chineseChars = (text.match(/[\u4e00-\u9fa5]/g) || []).length;
  const englishWords = text.replace(/[\u4e00-\u9fa5]/g, ' ').split(/\s+/).filter(w => w).length;
  return Math.ceil(chineseChars * 1.5 + englishWords * 1.3);
}
```

**Tokenè®¡è´¹ï¼š**
- GPT-4o: è¾“å…¥$2.5/1M tokens, è¾“å‡º$10/1M tokens
- DeepSeek: è¾“å…¥Â¥1/1M tokens, è¾“å‡ºÂ¥2/1M tokens

## å››ã€ä¸Šä¸‹æ–‡ç®¡ç†

### 4.1 å¯¹è¯å†å²ç®¡ç†

```javascript
class ConversationManager {
  constructor(maxTokens = 4000) {
    this.messages = [];
    this.maxTokens = maxTokens;
  }

  addMessage(role, content) {
    this.messages.push({ role, content });
    this.trimHistory();
  }

  trimHistory() {
    while (this.estimateTokens() > this.maxTokens && this.messages.length > 2) {
      this.messages.splice(1, 2);
    }
  }

  estimateTokens() {
    return this.messages.reduce((sum, m) => 
      sum + estimateTokens(m.content) + 4, 0
    );
  }
}
```

### 4.2 æ»‘åŠ¨çª—å£ç­–ç•¥

```javascript
function slidingWindow(messages, windowSize = 10) {
  if (messages.length <= windowSize) return messages;
  
  return [
    messages[0],
    ...messages.slice(-(windowSize - 1))
  ];
}
```

### 4.3 æ‘˜è¦å‹ç¼©ç­–ç•¥

```javascript
async function summarizeHistory(messages, llm) {
  const historyText = messages
    .map(m => `${m.role}: ${m.content}`)
    .join('\n');
  
  const summary = await llm.chat({
    messages: [{
      role: 'user',
      content: `è¯·ç”¨ç®€æ´çš„è¯­è¨€æ€»ç»“ä»¥ä¸‹å¯¹è¯å†å²ï¼š\n${historyText}`
    }]
  });
  
  return [
    messages[0],
    { role: 'assistant', content: `å†å²æ‘˜è¦ï¼š${summary}` }
  ];
}
```

## äº”ã€é”™è¯¯å¤„ç†ä¸é‡è¯•

### 5.1 é‡è¯•æœºåˆ¶

```javascript
async function withRetry(fn, options = {}) {
  const { maxRetries = 3, delay = 1000, backoff = 2 } = options;
  
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      
      const waitTime = delay * Math.pow(backoff, i);
      await new Promise(r => setTimeout(r, waitTime));
    }
  }
}
```

### 5.2 é”™è¯¯ç±»å‹å¤„ç†

```javascript
function handleLLMError(error) {
  if (error.status === 429) {
    return { type: 'rate_limit', retryAfter: error.headers?.['retry-after'] };
  }
  if (error.status === 401) {
    return { type: 'auth_error', message: 'APIå¯†é’¥æ— æ•ˆ' };
  }
  if (error.status === 400) {
    return { type: 'bad_request', message: error.message };
  }
  if (error.code === 'ECONNABORTED') {
    return { type: 'timeout', message: 'è¯·æ±‚è¶…æ—¶' };
  }
  return { type: 'unknown', message: error.message };
}
```

## å…­ã€å‰ç«¯é›†æˆæœ€ä½³å®è·µ

### 6.1 APIå¯†é’¥å®‰å…¨

```javascript
// ä¸è¦åœ¨å‰ç«¯æš´éœ²APIå¯†é’¥
// é€šè¿‡åç«¯ä»£ç†è°ƒç”¨

// å‰ç«¯
const response = await fetch('/api/chat', {
  method: 'POST',
  body: JSON.stringify({ message: 'ä½ å¥½' })
});

// åç«¯ä»£ç†
app.post('/api/chat', async (req, res) => {
  const result = await openai.chat.completions.create({
    model: 'gpt-4o',
    messages: req.body.messages
  });
  res.json(result);
});
```

### 6.2 è¯·æ±‚å–æ¶ˆ

```javascript
// AbortController  ç”¨äºå–æ¶ˆè¯·æ±‚
const controller = new AbortController();

async function chatWithAbort(message) {
  const signal = controller.signal;
  
  try {
    const response = await fetch('/api/chat', {
      method: 'POST',
      body: JSON.stringify({ message }),
      signal
    });
    return await response.json();
  } catch (error) {
    if (error.name === 'AbortError') {
      console.log('è¯·æ±‚å·²å–æ¶ˆ');
    }
    throw error;
  }
}

// å–æ¶ˆè¯·æ±‚
controller.abort();
```

### 6.3 å“åº”ç¼“å­˜

```javascript
const cache = new Map();

async function chatWithCache(message) {
  const cacheKey = JSON.stringify(message);
  
  if (cache.has(cacheKey)) {
    return cache.get(cacheKey);
  }
  
  const response = await openai.chat.completions.create({
    model: 'gpt-4o',
    messages: [message]
  });
  
  cache.set(cacheKey, response);
  return response;
}
```

## ä¸ƒã€é¢è¯•é«˜é¢‘é—®é¢˜

### Q1: LLMçš„Tokenæ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ

**ç­”æ¡ˆè¦ç‚¹ï¼š**
- Tokenæ˜¯æ–‡æœ¬çš„æœ€å°å¤„ç†å•ä½
- ä¸åŒæ¨¡å‹ä½¿ç”¨ä¸åŒçš„tokenizer(åˆ†è¯ç®—æ³•)
- æ¯”å¦‚ GPT-4oæ¨¡å‹ï¼Œè‹±æ–‡å•è¯1ä¸ªtokenï¼Œä¸­æ–‡æ±‰å­—1ä¸ªtoken
- ç‰¹æ®Šå­—ç¬¦å’Œæ ‡ç‚¹ç¬¦å·ä¹Ÿä¼šè¢«å½“ä½œ1ä¸ªtoken

### Q2: Temperatureå‚æ•°å¦‚ä½•å½±å“è¾“å‡ºï¼Ÿ

**ç­”æ¡ˆè¦ç‚¹ï¼š**
- temperatureè¶Šä½ï¼Œè¾“å‡ºè¶Šç¡®å®šã€ä¸€è‡´
- temperatureè¶Šé«˜ï¼Œè¾“å‡ºè¶Šéšæœºã€å¤šæ ·
- ä»£ç ç”Ÿæˆå»ºè®®0-0.3
- åˆ›æ„å†™ä½œå»ºè®®0.7-1.0

### Q3: å¦‚ä½•å¤„ç†LLMçš„å¹»è§‰é—®é¢˜ï¼Ÿ

> **ğŸ’¡ å¹»è§‰**ï¼ˆHallucinationï¼‰ï¼šæ¨¡å‹ç¼–é€ ä¸å­˜åœ¨çš„äº‹å®æˆ–ä¿¡æ¯ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šAIä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“ï¼Œè¯´å¾—å¤´å¤´æ˜¯é“ä½†å®Œå…¨æ˜¯ç¼–çš„ã€‚
> - **ä¾‹å­**ï¼šé—®"ã€Šçº¢æ¥¼æ¢¦ã€‹çš„ä½œè€…æ˜¯è°ï¼Ÿ"ï¼Œæ¨¡å‹å¯èƒ½å›ç­”"ã€Šçº¢æ¥¼æ¢¦ã€‹çš„ä½œè€…æ˜¯é²è¿…ï¼Œåˆ›ä½œäº1920å¹´..."ï¼Œè¿™å°±æ˜¯å¹»è§‰ï¼Œå› ä¸ºå®é™…ä½œè€…æ˜¯æ›¹é›ªèŠ¹ï¼Œåˆ›ä½œäºæ¸…æœã€‚

**ç­”æ¡ˆè¦ç‚¹ï¼š**
1. ä½¿ç”¨RAGå¼•å…¥å¤–éƒ¨çŸ¥è¯†
   > **ğŸ’¡ RAG**ï¼ˆRetrieval-Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ï¼šå…ˆä»çŸ¥è¯†åº“æ‰¾ç›¸å…³èµ„æ–™ï¼Œå†è®©AIåŸºäºèµ„æ–™å›ç­”ã€‚
   > - **é€šä¿—è§£é‡Š**ï¼šè®©AI"å¼€å·è€ƒè¯•"ï¼Œå…ˆç¿»ä¹¦æ‰¾ç­”æ¡ˆï¼Œå†å›ç­”é—®é¢˜ï¼Œå‡å°‘çç¼–ã€‚
   > - **ä¾‹å­**ï¼šé—®å…¬å¸æ”¿ç­–é—®é¢˜ï¼Œå…ˆä»å…¬å¸æ–‡æ¡£åº“æ£€ç´¢ç›¸å…³æ¡æ¬¾ï¼Œå†è®©AIåŸºäºæ£€ç´¢åˆ°çš„å†…å®¹å›ç­”ï¼Œè€Œä¸æ˜¯è®©AIå‡­ç©ºæƒ³è±¡ã€‚
2. è®¾ç½®è¾ƒä½çš„temperature
3. ä½¿ç”¨ç³»ç»Ÿæç¤ºçº¦æŸè¾“å‡º
4. è¦æ±‚æ¨¡å‹å¼•ç”¨æ¥æº
5. äººå·¥å®¡æ ¸å…³é”®å†…å®¹

### Q4: ä¸Šä¸‹æ–‡çª—å£é™åˆ¶å¦‚ä½•è§£å†³ï¼Ÿ

> **ğŸ’¡ ä¸Šä¸‹æ–‡çª—å£**ï¼ˆContext Windowï¼‰ï¼šæ¨¡å‹ä¸€æ¬¡èƒ½"è®°ä½"çš„æœ€å¤§æ–‡æœ¬é‡ã€‚
> - **é€šä¿—è§£é‡Š**ï¼šå°±åƒäººçš„çŸ­æœŸè®°å¿†å®¹é‡æœ‰é™ï¼ŒAIä¹Ÿæœ‰ä¸€ä¸ª"è®°å¿†å®¹é‡"ï¼Œè¶…è¿‡è¿™ä¸ªå®¹é‡å°±ä¼šå¿˜è®°å‰é¢çš„å†…å®¹ã€‚
> - **ä¾‹å­**ï¼šGPT-3.5çš„ä¸Šä¸‹æ–‡çª—å£æ˜¯4K tokensï¼ˆçº¦3000å­—ï¼‰ï¼Œè¶…è¿‡è¿™ä¸ªé•¿åº¦çš„å¯¹è¯ï¼Œæ¨¡å‹å°±ä¼š"å¿˜è®°"æœ€æ—©çš„å†…å®¹ã€‚GPT-4 Turboæœ‰128K tokensï¼ˆçº¦10ä¸‡å­—ï¼‰ï¼Œèƒ½è®°ä½æ›´é•¿çš„å¯¹è¯ã€‚

**ç­”æ¡ˆè¦ç‚¹ï¼š**
1. æ»‘åŠ¨çª—å£ï¼šä¿ç•™æœ€è¿‘çš„Nè½®å¯¹è¯
2. æ‘˜è¦å‹ç¼©ï¼šå¯¹å†å²å¯¹è¯è¿›è¡Œæ‘˜è¦
3. å‘é‡æ£€ç´¢ï¼šåªæ£€ç´¢ç›¸å…³å†å²ç‰‡æ®µ
   > **ğŸ’¡ å‘é‡æ£€ç´¢**ï¼šæŠŠæ–‡æœ¬è½¬æˆå‘é‡ï¼Œé€šè¿‡è®¡ç®—ç›¸ä¼¼åº¦æ‰¾åˆ°ç›¸å…³å†…å®¹ã€‚
   > - **é€šä¿—è§£é‡Š**ï¼šæŠŠæ¯æ®µè¯å˜æˆä¸€ä¸²æ•°å­—ï¼ˆå‘é‡ï¼‰ï¼Œæƒ³æ‰¾ç›¸å…³å†…å®¹æ—¶ï¼Œæ¯”è¾ƒæ•°å­—çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œæ‰¾å‡ºæœ€ç›¸å…³çš„å‡ æ®µã€‚
   > - **ä¾‹å­**ï¼šç”¨æˆ·é—®"ä¸Šæ¬¡è¯´çš„é‚£ä¸ªé¡¹ç›®è¿›åº¦æ€ä¹ˆæ ·"ï¼Œç³»ç»ŸæŠŠè¿™ä¸ªé—®é¢˜è½¬æˆå‘é‡ï¼Œåœ¨å†å²å¯¹è¯å‘é‡ä¸­æ‰¾æœ€ç›¸ä¼¼çš„ï¼Œå®šä½åˆ°ä¹‹å‰è®¨è®ºé¡¹ç›®è¿›åº¦çš„é‚£æ®µå¯¹è¯ã€‚
4. ä½¿ç”¨é•¿ä¸Šä¸‹æ–‡æ¨¡å‹ï¼ˆå¦‚Claude 200Kï¼‰
