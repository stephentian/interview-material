# 网络安全

- [XSS 跨站脚本攻击](#xss-跨站脚本攻击)
  - [XSS 类型](#xss-类型)
  - [XSS 防范措施](#xss-防范措施)
- [CSRF 跨站请求伪造](#csrf-跨站请求伪造)
  - [CSRF 攻击方式](#csrf-攻击方式)
  - [CSRF 防御措施](#csrf-防御措施)
- [XSS 和 CSRF 区别](#xss-和-csrf-区别)

## XSS 跨站脚本攻击

> cross site script

攻击者通过注入恶意脚本到网站页面中，来获取用户的信息或者执行某些恶意操作。

### XSS 类型

1. 来自用户输入框，表单提交的信息：后端未做清洗，直接进行拼接进 HTML 中，返回给客户端；
2. 来自URL：前端或者后端从 url query、url hash 中直接读取参数拼接进 HTML 中。

反射型(非持久型)

URL 加入脚本，当用户访问该 URL 时，网站会将恶意脚本回显到页面中，从而获取用户的敏感信息或者执行某些恶意操作。

存储型(持久型)

攻击者提交脚本给网站，网站会存储到数据库或缓存，当其他用户访问页面时，恶意脚本会被获取到页面中执行。获取用户的敏感信息或者执行某些恶意操作。

### XSS 防范措施

1. 对输入的数据进行转义保存，过滤数据。
2. 过滤标签，去除 `<script>, <iframe>` 标签。
3. 尽量避免使用 `eval` 或者 `new Function` 等执行字符串方法。
4. 使用 `HttpOnly cookie`，一种特殊的 cookie，它只能被服务器读取，不能被客户端js访问。

## CSRF 跨站请求伪造

> cross site request forgery

1. 用户登录 A 网站，存了 A 网站的 Cookie,
2. 然后用户在未退出 A 网站时访问黑客的 B 网站（可能是伪造网站）；
3. 可能用户点击 B 网站链接，B 网站向 A 网站的发起请求，浏览器会自动携带 A 网站的 Cookie;
4. A 网站验证 Cookie 有效，执行 B 网站的请求，从而导致用户数据被修改（新浪微博莫名其妙增加关注）

### CSRF 攻击方式

通过图片URL、超链接、CORS、Form提交等等一切可以发送请求的地方。

### CSRF 防御措施

1. Token 验证：服务器生成随机 Token 并存储，请求时需携带该 Token，攻击者无法获取
2. SameSite Cookie 属性：设置 `SameSite=Strict` 或 Lax，限制 Cookie 仅在同源请求中携带
3. Referer/Origin 验证：检查 HTTP 请求头 referer 是否为同源（Origin）
4. 隐藏令牌
  隐藏令牌，类似 token， 比如藏在 http header 中

## XSS 和 CSRF 区别

1. 攻击方式：XSS 是一种注入攻击，注入脚本到用户页面；CSRF是一种伪造用户请求攻击。
2. 防御方式：防御 XSS 攻击的主要方式是过滤用户输入，防止恶意脚本的注入。而防御 CSRF 攻击的主要方式是添加验证码或者 token，以验证请求的真实性。
3. 攻击对象：XSS 攻击的对象是网站页面的用户，CSRF 攻击的对象是网站的后台管理员或者其他有权限的用户。
4. 攻击条件：XSS 可以不需要用户登录，CSRF 需要用户登录。
